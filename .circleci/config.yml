version: 2.1

executors:
  default:
    docker:
      - name: ruby
        image: ruby:2.6.5

commands:
  pre-setup:
    steps:
      - run: git submodule init
      - run: git submodule update
      - run: bundle install

  rake:
    steps:
      - run: bundle exec rake

  rubocop:
    steps:
      - run: bundle exec rake

jobs:
  build:
    executor: default
    steps:
      - checkout
      - pre-setup
  rspec:
    executor: default
      - rake
  rubocop:
    executor: default
      - rubocop

workflows:
  version: 2
  test:
    jobs:
      - build
      - rspec:
        requires:
          - build
      - rubocop:
        requires:
          - build
